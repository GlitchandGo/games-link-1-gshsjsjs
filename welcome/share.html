<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Status & Share</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #status { margin-bottom: 20px; font-size: 1.2em; }
    select, button { padding: 8px 12px; margin: 5px; }
    #shareLink { margin-top: 20px; word-break: break-all; }
  </style>
</head>
<body>
  <h2>Access Cookie Status</h2>
  <div id="status">Checkingâ€¦</div>

  <div id="controls" style="display:none;">
    <label for="duration">Share duration:</label>
    <select id="duration">
      <option value="1h">1 hour</option>
      <option value="6h">6 hours</option>
      <option value="12h">12 hours</option>
      <option value="1d">1 day</option>
    </select>
    <button id="shareBtn">Generate Share Link</button>
  </div>

  <div id="shareLink"></div>

  <script>
    function hasAccessCookie() {
      const raw = document.cookie.split("; ").find(c => c.startsWith("access="));
      if (!raw) return false;
      const val = raw.split("=")[1];
      return val === "1";
    }

    function base64(str) { return btoa(unescape(encodeURIComponent(str))); }
    function hex(str) { return Array.from(str).map(c => c.charCodeAt(0).toString(16).padStart(2,"0")).join(""); }
    function encodeChain(str) {
      let result = str;
      const steps = [base64, hex, base64, hex, base64, hex];
      for (const step of steps) result = step(result);
      return hex(result); // final wrap
    }
    function checksum(str) {
      let sum = 0;
      for (let i=0;i<str.length;i++) sum = (sum + str.charCodeAt(i)*(i+1)) % 100000;
      return sum.toString().padStart(5,"0");
    }

    function updateStatus() {
      const statusEl = document.getElementById("status");
      if (hasAccessCookie()) {
        statusEl.textContent = "Access cookie found (value=1). You can share access.";
        document.getElementById("controls").style.display = "block";
      } else {
        statusEl.textContent = "No valid access cookie found.";
      }
    }

    function generateShareLink() {
      const duration = document.getElementById("duration").value;
      const now = new Date();
      let expiry = new Date(now);
      if (duration === "1h") expiry.setHours(expiry.getHours()+1);
      if (duration === "6h") expiry.setHours(expiry.getHours()+6);
      if (duration === "12h") expiry.setHours(expiry.getHours()+12);
      if (duration === "1d") expiry.setDate(expiry.getDate()+1);

      const iso = expiry.toISOString();
      const raw = `${iso}:${duration}`;
      const code = `${raw}:${checksum(raw)}`;
      const encoded = encodeChain(code);

      const url = `https://aurorastorage.giize.com/activation/receive.html?a=${encoded}`;
      document.getElementById("shareLink").textContent = url;
    }

    document.getElementById("shareBtn").addEventListener("click", generateShareLink);
    updateStatus();
  </script>
</body>
</html>
