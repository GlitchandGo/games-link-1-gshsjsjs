<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome Page</title>
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/Sirco-team/files/refs/heads/main/ugb/UBG_favcon.png">
    <link rel="stylesheet" href="style.css">
    <script src="main.js" defer></script>
</head>
<body>
    <!-- Account icon in top right -->
    <a href="/CODE/account" id="account-icon-link" style="
        position:fixed;
        top:18px;
        right:22px;
        z-index:10001;
        background:#fff;
        border-radius:50%;
        box-shadow:0 2px 8px #0002;
        width:44px;
        height:44px;
        display:flex;
        align-items:center;
        justify-content:center;
        text-decoration:none;
        border:1px solid #eee;
        transition:box-shadow 0.2s;
    " title="Account">
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none" style="display:block;" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="8" r="4" stroke="#007bff" stroke-width="2" fill="none"/>
            <path d="M4 20c0-3.3137 3.134-6 7-6s7 2.6863 7 6" stroke="#007bff" stroke-width="2" fill="none"/>
        </svg>
    </a>

    <!-- Banner iframe, visibility controlled by showBanner -->
    <iframe 
        id="banner-frame"
        title="Banner"
        scrolling="no"
        style="height:60px;" <!-- fallback height -->
    ></iframe>
    <script>
        // Set the banner iframe src with cache-busting using JS (like fetchVersion)
        document.getElementById('banner-frame').src = `/banner.html?nocache=${new Date().getTime()}`;
    </script>

    <div class="footer-container">
        <p>
            Disclaimer: This website and its contents are provided for entertainment purposes only. 
            We are not responsible for any misuse of the services offered, including violations of 
            rules, policies, or laws in your location or institution. Accessing this site using unauthorized 
            devices or networks is prohibited. By using this site, you accept full responsibility for compliance.
        </p>
    </div>

    <div class="container">
        <h1>Welcome to UBG UNIVERSE</h1>
        <p>Welcome to the brand new UBG lineup called UBG UNIVERSE.</p>

        <!-- Top Buttons -->
        <div class="button-group">
            <button onclick="removeAccessKey();">Remove Access Key</button>
            <button onclick="window.location.href='/updates.txt';">View Updates</button>
        </div>

        <!-- Main Buttons -->
        <div class="button-group">
            <button onclick="window.location.href='/CODE/games';">Games</button>
            <button onclick="window.open('http://mc.code-faction.gleeze.com/CODE/storage/', '_self');">Storage</button>
            <button onclick="window.location.href='/CODE/proxys';">Proxys</button>
            <button onclick="window.location.href='/CODE/ais';">AI's</button>
            <button onclick="window.location.href='/CODE/tools';">Tools</button>
            <button onclick="window.location.href='/CODE/testing';">Testing Help</button>
        </div>
    </div>

    <div class="version-footer">
        <p>Site Version: <span id="siteVersion">Loading...</span></p>
    </div>

    <!-- Cookie Cleanup Popup -->
    <div id="cookie-popup" style="display:none; position:fixed; z-index:10002; top:0; left:0; width:100vw; height:100vh; background:#0008; align-items:center; justify-content:center;">
        <div style="background:#fff; max-width:400px; margin:auto; padding:32px 24px 24px 24px; border-radius:12px; box-shadow:0 4px 24px #0003; text-align:center; position:relative;">
            <h2>Action Required: Clear Cookies</h2>
            <p>
                The site owner requests that you <b>delete all cookies</b> for this site to ensure new updates work properly.<br><br>
                <b>How to do it:</b>
                <ol style="text-align:left; margin:1em auto 1em 1.5em;">
                    <li>Click the lock icon in your browser's address bar.</li>
                    <li>Go to <b>Site settings</b> or <b>Cookies and site data</b>.</li>
                    <li>Delete or clear all cookies for this site.</li>
                    <li>Return to this page (do <b>not</b> refresh).</li>
                </ol>
                When done, click the button below. We'll restore important cookies for you.
            </p>
            <button id="cookie-popup-confirm" style="margin-top:16px; padding:10px 24px; font-size:1rem; border-radius:6px; border:none; background:#007bff; color:#fff; cursor:pointer;">I deleted the cookies</button>
        </div>
    </div>

    <script>
    // --- Cookie Version System ---
    const COOKIE_VERSION = 2; // Increment this when cookies need to be reset
    const IMPORTANT_COOKIES = [
        'cookie_saver_email',
        'cookie_saver_name',
        'cookie_saver_password',
        'newsletter_hide',
        'cookie_saver_signedup',
        'cookie_saver_username',
        'access'
    ];

    // --- Date Check from cookie.json ---
    function checkCookieJsonDate() {
        fetch('/cookie.json')
            .then(res => res.json())
            .then(data => {
                if (data && data.date) {
                    const cookieDate = new Date(data.date);
                    const now = new Date();
                    if (cookieDate < now) {
                        showCookiePopup();
                    }
                }
            })
            .catch(() => {
                // Ignore errors if cookie.json not found
            });
    }

    function getCookie(name) {
        const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
        return match ? decodeURIComponent(match[2]) : null;
    }
    function setCookie(name, value, days = 365) {
        const expires = new Date(Date.now() + days*864e5).toUTCString();
        document.cookie = name + '=' + encodeURIComponent(value) + '; path=/; expires=' + expires;
    }
    function delCookie(name) {
        document.cookie = name + '=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT';
    }
    function getAllCookies() {
        return document.cookie.split(';').reduce((acc, c) => {
            const [k, ...v] = c.trim().split('=');
            acc[k] = v.join('=');
            return acc;
        }, {});
    }

    function checkCookieVersion() {
        const stored = parseInt(getCookie('cookie_version') || '0', 10);
        if (stored < COOKIE_VERSION) {
            showCookiePopup();
        }
    }

    function showCookiePopup() {
        // Save important cookies to memory
        const saved = {};
        IMPORTANT_COOKIES.forEach(k => {
            const v = getCookie(k);
            if (v !== null) saved[k] = v;
        });
        window._importantCookiesBackup = saved;
        // Show popup
        document.getElementById('cookie-popup').style.display = 'flex';
    }

    function restoreImportantCookies() {
        const saved = window._importantCookiesBackup || {};
        // Remove all cookies
        Object.keys(getAllCookies()).forEach(delCookie);
        // Restore important cookies
        Object.entries(saved).forEach(([k, v]) => setCookie(k, v));
        setCookie('cookie_version', COOKIE_VERSION);
    }

    document.getElementById('cookie-popup-confirm').onclick = function() {
        restoreImportantCookies();
        document.getElementById('cookie-popup').style.display = 'none';
        alert('Important cookies restored! You may continue using the site.');
    };

    // Run version check on load
    checkCookieVersion();
    checkCookieJsonDate();
    </script>
    <script src="/analytics.js?5h"></script>
    <script src="/newsletter.js?67herth676"></script>
</body>
</html>
